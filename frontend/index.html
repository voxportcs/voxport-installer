<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxportCS Enterprise Control Panel</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/core.js"></script>
    <script src="assets/js/core.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --bg-main: #f8fafc;
            --sidebar-bg: #ffffff;
            --sidebar-text: #475569;
            --header-bg: #ffffff;
            --text-main: #1e293b;
            --sidebar-width: 240px; /* Reduced width */
        }

        body.dark-mode {
            --bg-main: #0f172a;
            --sidebar-bg: #1e293b;     
            --sidebar-text: #94a3b8;
            --header-bg: #1e293b;
            --text-main: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-main); color: var(--text-main); overflow: hidden; height: 100vh; }

        /* Hide Scrollbar for Chrome, Safari and Opera */
        .menu-scroll::-webkit-scrollbar { display: none; }
        .menu-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        .app-container { display: flex; height: 100vh; width: 100vw; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .logo-section { padding: 20px; border-bottom: 1px solid rgba(0,0,0,0.05); text-align: center; }
        .logo-section h1 { color: var(--primary); font-weight: 800; font-size: 22px; text-transform: lowercase; }
        .logo-section span { font-size: 10px; font-weight: 700; color: #94a3b8; letter-spacing: 1px; }

        .menu-scroll { flex: 1; overflow-y: auto; padding: 10px; }
        .nav-label { font-size: 9px; font-weight: 800; color: #94a3b8; margin: 15px 12px 8px; text-transform: uppercase; letter-spacing: 1px; }

        .nav-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 12px; margin-bottom: 2px; border-radius: 8px;
            cursor: pointer; color: var(--sidebar-text); font-size: 12px; font-weight: 600;
            transition: all 0.2s;
        }
        .nav-item:hover { background: rgba(79, 70, 229, 0.05); color: var(--primary); }
        .nav-item i.main-icon { width: 18px; font-size: 14px; margin-right: 10px; }

        .submenu { display: none; padding-left: 38px; }
        .submenu.active { display: block; }
        .submenu a { display: block; padding: 6px 0; font-size: 12px; color: #64748b; text-decoration: none; cursor: pointer; transition: 0.2s; }
        .submenu a:hover { color: var(--primary); }

        /* HEADER */
        .top-header {
            height: 60px; background: var(--header-bg); border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }

        /* Profile Dropdown */
        .profile-dropdown {
            position: absolute; top: 65px; right: 25px; width: 220px;
            background: var(--sidebar-bg); border: 1px solid rgba(0,0,0,0.1);
            border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: none; flex-direction: column; overflow: hidden; z-index: 1000;
        }
        .profile-dropdown.show { display: flex; }
        .dropdown-link { padding: 12px 15px; font-size: 13px; color: var(--sidebar-text); display: flex; align-items: center; gap: 10px; cursor: pointer; transition: 0.2s; }
        .dropdown-link:hover { background: rgba(79, 70, 229, 0.05); color: var(--primary); }
        .dropdown-link.logout { color: #ef4444; border-top: 1px solid rgba(0,0,0,0.05); }

        .theme-toggle { width: 35px; height: 35px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .content-body { flex: 1; overflow-y: auto; padding: 20px; }
    </style>

</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="logo-section">
            <h1>VoxportCS</h1>
            <span>ENTERPRISE VOIP</span>
        </div>

        <div class="menu-scroll">
            <div class="nav-item" onclick="loadModule('dashboard.html', this)">
                <span><i class="fa-solid fa-chart-line main-icon"></i> DASHBOARD</span>
            </div>

            <div class="nav-label">Management</div>
            
            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-users-gear main-icon"></i> Account Setup</span>
                <i class="fa-solid fa-chevron-right arrow text-[10px] transition-transform"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('add-account.html', this)">Add Account</a>
                <a onclick="loadModule('ip-management.html', this)">IP Management</a>
                <a onclick="loadModule('sip-dashboard.html', this)">SIP Dashboard</a>
                <a onclick="loadModule('caller-id.html', this)">Caller ID Settings</a>
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-headset main-icon"></i> Inbound Services</span>
                <i class="fa-solid fa-chevron-right arrow text-[10px]"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('did-management.html', this)">DID Management</a>
                <a onclick="loadModule('forwarding.html', this)">Forwarding Groups</a>
                <a onclick="loadModule('queue-management.html', this)">Queue Management</a>
                <a onclick="loadModule('extensions-ivr.html', this)">Extensions & IVR Master</a>   
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-layer-group main-icon"></i> Rates </span>
                <i class="fa-solid fa-chevron-right arrow text-[10px]"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('rate-group.html', this)">Rate Group</a>
                <a onclick="loadModule('rate-list.html', this)">Rate List</a>
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-bullhorn main-icon"></i> Campaigns</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('campaign-management.html')">Campaign Management</a>
                <a onclick="loadModule('target-management.html')">Target Management</a>
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-network-wired main-icon"></i> Wholesale Config</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>
            <div class="submenu">
                 <a onclick="loadModule('provider-account.html', this)">Provider</a>
                <a onclick="loadModule('gateway-config.html')">Gateway Config</a>
                <a onclick="loadModule('trunk-management.html')">Trunk Management</a>
            </div>

            <div class="nav-label">Analysis & Billing</div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-magnifying-glass-chart main-icon"></i> Analytics</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>

            <div class="submenu">
               <a data-perm="dashboard.view" onclick="loadModule('live-monitor.html')">Live Monitor</a>
               <a data-perm="security.view" onclick="loadModule('activity-log.html')">Activity Log</a>
               <a data-perm="cdr.view" onclick="loadModule('cdr-logs.html')">CDR Logs</a>
               <a data-perm="billing.view" onclick="loadModule('revenue-summary.html')">Revenue Summary</a>
            </div>

            <div class="nav-item" data-perm="billing.view" onclick="toggleSub(this)">
               <span><i class="fa-solid fa-wallet main-icon"></i> Billing System</span>
               <i class="fa-solid fa-chevron-right arrow text-[10px]"></i>
            </div>

            <div class="submenu">
               <a data-perm="cdr.view" onclick="loadModule('recordings.html')">Call Recordings</a>
               <a data-perm="billing.view" onclick="loadModule('payment-records.html')">Payments</a>
               <a data-perm="billing.manage" onclick="loadModule('invoices.html')">Invoices (PDF)</a>
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-shield-halved main-icon"></i> Firewall</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('fail2Ban-manager.html')">Fail2Ban Manager</a>
                <a onclick="loadModule('robocall-manager.html')">Robocall Management</a>
                <a onclick="loadModule('security-logs.html')">Security Logs</a>
                <a onclick="loadModule('sip-trace.html')">Sip Trace</a>
                <a onclick="loadModule('speech-intelligence.html')">Speech Intelligence</a>
            </div>

            <div class="nav-label">System & Help</div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-life-ring main-icon"></i> Support</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('tickets.html')">Tickets</a>
                <a onclick="loadModule('docs.html')">Documentation</a>
            </div>

            <div class="nav-item" onclick="toggleSub(this)">
                <span><i class="fa-solid fa-gears main-icon"></i> Settings</span>
                <i class="fa-solid fa-chevron-right arrow"></i>
            </div>
            <div class="submenu">
                <a onclick="loadModule('profile.html')">My Profile</a>
                <a onclick="loadModule('branding.html')">Panel Branding</a>
                <a onclick="loadModule('permissions.html')">Permission</a>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="top-header">
            <div class="text-[11px] font-bold text-slate-400 uppercase tracking-wider">
                Panel / <span id="mod-name" class="text-indigo-600">Home</span>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="theme-toggle" onclick="toggleMode()">
                    <i id="mode-icon" class="fa-solid fa-moon text-slate-500"></i>
                </div>
                
                <div class="relative">
                    <div class="flex items-center gap-3 pl-4 border-l border-slate-100 cursor-pointer" onclick="toggleProfileMenu()">
                        <div class="text-right hidden sm:block">
                            <p id="u-name" class="text-xs font-bold text-slate-700 leading-tight">Admin</p>
                            <p class="text-[9px] text-emerald-500 font-bold uppercase tracking-tighter">Online</p>
                        </div>
                        <img id="u-avatar" src="https://ui-avatars.com/api/?name=Admin&background=4f46e5&color=fff" class="w-8 h-8 rounded-lg shadow-sm">
                    </div>

                    <div class="profile-dropdown" id="profileMenu">
                        <div class="p-4 border-bottom bg-slate-50/50">
                            <p class="text-xs font-bold text-slate-800">Account Settings</p>
                            <p class="text-[10px] text-slate-500">Manage your profile info</p>
                        </div>
                        <div class="dropdown-link" onclick="loadModule('profile.html', this); toggleProfileMenu()">
                            <i class="fa-solid fa-user-pen"></i> Edit Profile
                        </div>
                        <div class="dropdown-link" onclick="loadModule('security.html', this); toggleProfileMenu()">
                            <i class="fa-solid fa-key"></i> Change Password
                        </div>

                        <div class="dropdown-link logout">
                          <button id="btnLogout" style="width:100%;text-align:left;">
                           <i class="fa-solid fa-right-from-bracket"></i> Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-body" id="main-content">
            <div class="flex h-full flex-col items-center justify-center text-slate-200">
                <i class="fa-solid fa-microchip text-7xl mb-4"></i>
                <h2 class="text-xl font-bold text-slate-300 tracking-tight">VOIP SYSTEM READY</h2>
                <p class="text-xs font-medium">Select a module from the management sidebar</p>
            </div>
        </div>
    </main>
</div>

<script>

    // 3. UI INTERACTIONS
    function toggleSub(el) {
        const sub = el.nextElementSibling;
        const arrow = el.querySelector('.arrow');
        const isActive = sub.classList.contains('active');
        
        document.querySelectorAll('.submenu').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.arrow').forEach(a => a.style.transform = 'rotate(0deg)');

        if (!isActive) {
            sub.classList.add('active');
            arrow.style.transform = 'rotate(90deg)';
        }
    }

    function toggleProfileMenu() {
        document.getElementById('profileMenu').classList.toggle('show');
    }

    function toggleMode() {
        document.body.classList.toggle('dark-mode');
        const icon = document.getElementById('mode-icon');
        icon.className = document.body.classList.contains('dark-mode') ? 'fa-solid fa-sun text-amber-400' : 'fa-solid fa-moon text-slate-500';
    }

    // Close dropdown on outside click
    window.onclick = function(event) {
        if (!event.target.closest('.relative')) {
            document.getElementById('profileMenu').classList.remove('show');
        }
    }


 // UPDATED MODULE LOADER
Panel.loadModule = function(page, element = null) {
    const content = document.getElementById('main-content');
    const modTitle = document.getElementById('mod-name');
    modTitle.innerText = page.replace('.html', '').toUpperCase();

    // Highlight menu
    document.querySelectorAll('.submenu a, .nav-item').forEach(el =>
        el.classList.remove('text-indigo-600', 'font-bold')
    );
    if (element) element.classList.add('text-indigo-600', 'font-bold');

    content.innerHTML = `
      <div class="flex h-full items-center justify-center animate-pulse text-slate-400 font-bold">
        Loading Module...
      </div>`;

    fetch('modules/' + page)
        .then(res => {
            if (!res.ok) throw new Error('Module not found');
            return res.text();
        })
        .then(html => {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            content.innerHTML = doc.body.innerHTML;

            // Execute module scripts safely
            doc.querySelectorAll("script").forEach(old => {
                const s = document.createElement("script");
                if (old.src) {
                    s.src = old.src;
                } else {
                    s.textContent = `(function(){try{${old.textContent}}catch(e){console.error(e)}})();`;
                }
                document.body.appendChild(s);
                s.remove();
            });
        })
        .catch(err => {
            content.innerHTML = `<div class="p-10 text-red-500 font-bold">${err.message}</div>`;
        });
};
// BACKWARD COMPATIBILITY
window.loadModule = Panel.loadModule;

</script>
</body>
</html>
